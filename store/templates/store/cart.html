{% extends 'store/main.html' %}
{% load static %}
{% block content %}

<div class="row">
    <div class="col-lg-12">
        <div class="box-element">

            <a class="btn btn-outline-dark" href="{% url 'store:home' %}">
                &#x2190; Continue Shopping
            </a>

            <br><br>

            <table class="table">
                <tr>
                    <th>
                        <h5>Items: <strong>{{ cartItems }}</strong></h5>
                    </th>
                    <th>
                        <h5>Total: <strong>₹{{ order.get_cart_total }}</strong></h5>
                    </th>
                    <th>
                        <a style="float:right; margin:5px;"
                           class="btn btn-success"
                           href="{% url 'store:checkout' %}">
                            Proceed to Checkout
                        </a>
                    </th>
                </tr>
            </table>

        </div>

        <br>

        <div class="box-element">
            <div class="cart-row">
                <div style="flex:2"><strong>Item</strong></div>
                <div style="flex:2"><strong>Item Name</strong></div>
                <div style="flex:1"><strong>Price</strong></div>
                <div style="flex:1"><strong>Quantity</strong></div>
                <div style="flex:1"><strong>Total</strong></div>
                <div style="flex:0.5"><strong>Action</strong></div>
            </div>

            {% for item in items %}
            <div class="cart-row">

                <!-- FIRST COLUMN : IMAGE + DETAILS (JS SAFE) -->
                <div style="flex:2">

                    <!-- IMAGE ADDED HERE (SAFE POSITION) -->
                    {% if item.product.image %}
                    <img src="{{ item.product.image.url }}"
                         style="width:80px; height:80px; object-fit:cover; border-radius:8px; margin-bottom:8px;">
                    {% else %}
                    <img src="{% static 'images/placeholder.png' %}"
                         style="width:80px; height:80px; object-fit:cover; margin-bottom:8px;">
                    {% endif %}

                    <!-- Size -->
                    {% if item.size %}
                    <p class="mb-1"><small>Size: {{ item.size }}</small></p>
                    {% endif %}

                    <!-- Color -->
                    {% if item.color %}
                    <p class="mb-1">
                        <small>Color:</small>
                        <span
                                style="
                                width: 14px;
                                height: 14px;
                                border-radius: 50%;
                                background-color: {{ item.color }};
                                border: 1px solid #000;
                                display: inline-block;
                            ">
                        </span>
                    </p>
                    {% endif %}
                </div>

                <!-- ITEM NAME COLUMN -->
                <div style="flex:2">
                    <p>{{ item.product.name }}</p>
                </div>

                <!-- PRICE -->
                <div style="flex:1">
                    <p>₹{{ item.product.price }}</p>
                </div>

                <!-- QUANTITY COLUMN -->
                <div style="flex:1">
                    <div class="quantity-wrapper">

                        <span class="quantity-value">{{ item.quantity }}</span>

                        <div class="arrow-wrapper">

                            <!-- ADD BUTTON (ALWAYS ENABLED) -->
                            <img
                                    data-product="{{ item.product.id }}"
                                    data-action="add"
                                    data-size="{{ item.size|default_if_none:'' }}"
                                    data-color="{{ item.color|default_if_none:'' }}"
                                    class="chg-quantity update-cart"
                                    src="{% static 'images/arrow-up.png' %}">


                            <!-- REMOVE / DELETE LOGIC -->
                            {% if item.quantity > 1 %}
                            <img
                                    data-product="{{ item.product.id }}"
                                    data-action="remove"
                                    data-size="{{ item.size|default_if_none:'' }}"
                                    data-color="{{ item.color|default_if_none:'' }}"

                                    class="chg-quantity update-cart"
                                    src="{% static 'images/arrow-down.png' %}">
                            {% else %}
                            <!-- DISABLED REMOVE WHEN QTY = 1 -->
                            <img
                                    src="{% static 'images/arrow-down.png' %}"
                                    class="chg-quantity update-cart"
                                    style="opacity:0.3; pointer-events:none;">
                            {% endif %}


                        </div>
                    </div>
                </div>


                <!-- TOTAL -->
                <div style="flex:1">
                    <p>₹{{ item.get_total }}</p>
                </div>

                <!-- ACTION COLUMN (DELETE BUTTON AT END) -->
                <div style="flex:0.5; text-align:center;">
                    <button
                            data-product="{{ item.product.id }}"
                            data-action="delete"
                            data-size="{{ item.size|default_if_none:'' }}"
                            data-color="{{ item.color|default_if_none:'' }}"
                            class="btn btn-danger btn-sm update-cart">
                        ❌
                    </button>


                </div>


            </div>
            {% endfor %}

        </div>
    </div>
</div>

{% endblock content %}
